# JS Screenshot Tool - 需求文档

## 项目概述

**项目名称**: js-screenshot  
**版本**: 1.0.0  
**技术栈**: TypeScript + Preact + HTML5 Canvas + WebRTC  
**项目类型**: 基于 Web 技术的截图工具库  

### 项目背景
本项目是一个轻量级、用户友好的截图工具，采用现代 Web 技术构建，具有动漫风格的 UI 设计。项目已从原生 DOM 操作重构为 Preact 函数式组件架构，提供更好的可维护性和开发体验。

## 核心功能需求

### 1. 屏幕捕获功能
- **全屏捕获**: 支持捕获整个屏幕内容
- **区域选择**: 用户可以通过拖拽选择特定区域进行截图
- **实时预览**: 在选择区域时提供实时预览效果
- **技术实现**: 使用 WebRTC Screen Capture API (`navigator.mediaDevices.getDisplayMedia`)

### 2. 图像编辑工具
#### 2.1 绘图工具
- **画笔工具 (PenTool)**: 
  - 自由手绘功能
  - 支持不同颜色和粗细设置
  - 平滑的绘制体验
  
- **箭头工具 (ArrowTool)**:
  - 绘制指向性箭头
  - 支持不同样式和颜色
  - 用于标注和指示

- **文本工具 (TextBoxTool)**:
  - 添加文本注释
  - 支持字体大小和颜色调整
  - 文本框可拖拽和调整大小

- **马赛克工具 (MosaicTool)**:
  - 隐私保护功能
  - 对敏感信息进行模糊处理
  - 可调节模糊程度

#### 2.2 操作控制
- **撤销/重做**: 支持操作历史管理
- **清除**: 清除所有编辑内容
- **重置**: 恢复到原始截图状态

### 3. 用户界面需求
- **动漫风格设计**: 采用现代、美观的动漫风格 UI
- **直观操作**: 鼠标拖拽、点击等直观的交互方式
- **工具栏**: 浮动工具栏，包含所有编辑工具
- **控制点**: 选区四角和边缘的控制点，支持调整大小
- **实时反馈**: 操作过程中的视觉反馈

### 4. 输出功能
- **保存本地**: 将截图保存到本地文件系统
- **格式支持**: 支持 PNG、JPEG 等常见图片格式
- **质量控制**: 可调节输出图片质量

## 技术架构需求

### 1. 组件架构
```
ScreenShot (主组件)
├── ScreenshotProvider (Context 提供者)
├── CutoutBox (裁剪框组件)
├── ToolBox (工具栏组件)
├── DotController (控制点组件)
└── Tools (工具组件集合)
    ├── PenTool
    ├── ArrowTool
    ├── TextBoxTool
    └── MosaicTool
```

### 2. 状态管理
- **全局状态**: 使用 Preact Context API 管理全局状态
- **Canvas 管理**: 分离源画布和绘制画布
- **历史记录**: 操作历史的存储和管理
- **工具状态**: 当前激活工具和相关配置

### 3. 核心模块
- **Canvas 绘制引擎**: 基于 HTML5 Canvas 2D API
- **事件处理系统**: 鼠标事件、键盘事件的统一处理
- **工具系统**: 可扩展的绘图工具架构
- **渲染系统**: 组件渲染和 DOM 操作的抽象层

## 性能需求

### 1. 响应性能
- **初始化时间**: 工具启动时间 < 500ms
- **绘制响应**: 绘制操作响应时间 < 16ms (60fps)
- **内存使用**: 合理的内存占用，避免内存泄漏

### 2. 兼容性
- **浏览器支持**: Chrome 88+, Firefox 85+, Safari 14+
- **屏幕分辨率**: 支持各种分辨率的屏幕
- **设备支持**: 桌面端为主，考虑触摸设备兼容性

## 开发环境需求

### 1. 构建工具
- **打包工具**: Rollup
- **开发服务器**: Vite (playground)
- **包管理**: pnpm
- **代码规范**: ESLint + TypeScript

### 2. 开发依赖
```json
{
  "preact": "^10.27.2",
  "@preact/compat": "^18.3.1",
  "typescript": "^5.3.3",
  "rollup": "^3.28.0",
  "sass": "^1.70.0"
}
```

## 用户体验需求

### 1. 操作流程
1. 用户点击"截屏"按钮启动工具
2. 系统请求屏幕捕获权限
3. 用户选择要捕获的屏幕/窗口
4. 显示选区框，用户拖拽调整截图区域
5. 用户使用工具栏进行图像编辑
6. 用户点击保存按钮完成截图

### 2. 交互设计
- **选区调整**: 拖拽边缘和角落调整选区大小
- **工具切换**: 点击工具栏图标切换编辑工具
- **参数调整**: 通过滑块或输入框调整工具参数
- **快捷操作**: 支持常用快捷键操作

## 质量需求

### 1. 代码质量
- **TypeScript**: 100% TypeScript 覆盖，严格类型检查
- **代码规范**: 遵循 ESLint 规范
- **组件化**: 高内聚、低耦合的组件设计
- **可维护性**: 清晰的代码结构和注释

### 2. 错误处理
- **权限处理**: 优雅处理屏幕捕获权限被拒绝的情况
- **兼容性检查**: 检测浏览器 API 支持情况
- **异常恢复**: 提供错误恢复机制
- **用户提示**: 友好的错误提示信息

## 部署需求

### 1. 构建输出
- **ES Module**: 支持现代模块系统
- **UMD**: 兼容传统模块系统
- **CSS**: 独立的样式文件
- **类型定义**: TypeScript 声明文件

### 2. 分发方式
- **NPM 包**: 发布到 NPM 仓库
- **CDN**: 支持 CDN 引入
- **本地集成**: 支持本地项目集成

## 扩展性需求

### 1. 工具扩展
- **插件系统**: 支持自定义绘图工具
- **主题系统**: 支持自定义 UI 主题
- **配置系统**: 支持工具行为配置

### 2. API 设计
- **简洁 API**: 提供简单易用的 API 接口
- **事件系统**: 支持截图过程中的事件监听
- **回调机制**: 支持自定义完成回调

## 测试需求

### 1. 功能测试
- **核心功能**: 截图、编辑、保存功能测试
- **兼容性测试**: 不同浏览器和设备的兼容性
- **性能测试**: 大尺寸图片处理性能测试

### 2. 用户测试
- **易用性测试**: 用户操作流程的易用性
- **界面测试**: UI 界面的美观性和一致性
- **体验测试**: 整体用户体验评估

## 文档需求

### 1. 开发文档
- **API 文档**: 详细的 API 使用说明
- **组件文档**: 组件使用和配置说明
- **架构文档**: 技术架构和设计思路

### 2. 用户文档
- **使用指南**: 用户操作指南
- **示例代码**: 集成使用示例
- **常见问题**: FAQ 和问题解决方案

## 项目里程碑

### Phase 1: 核心功能 (已完成)
- ✅ 基础截图功能
- ✅ Preact 组件架构重构
- ✅ Canvas 绘制系统
- ✅ 基础工具实现

### Phase 2: 功能完善 (进行中)
- 🔄 截图功能调试和优化
- 🔄 工具功能完善
- 🔄 用户界面优化
- 🔄 错误处理完善

### Phase 3: 质量提升 (计划中)
- ⏳ 性能优化
- ⏳ 兼容性测试
- ⏳ 文档完善
- ⏳ 发布准备

## 风险评估

### 1. 技术风险
- **浏览器兼容性**: Screen Capture API 的浏览器支持
- **性能问题**: 大尺寸图片处理可能的性能瓶颈
- **权限限制**: 用户拒绝屏幕捕获权限

### 2. 解决方案
- **渐进增强**: 提供降级方案
- **性能优化**: 使用 Web Workers 处理大图片
- **用户引导**: 提供权限申请引导

---

**文档版本**: 1.0  
**创建日期**: 2025-11-21  
**最后更新**: 2025-11-21  
**维护者**: 张镭银